const chalk = require('chalk')
const truffleAssert = require('truffle-assertions')
const txUtils = require('./utils/txUtils')

const everbinArtifacts = artifacts.require("Everbin.sol")

contract('Everbin', accounts => {
    const [owner, user1, user2] = accounts
    let everbin;

    let smallText = "This is just a small text. It's not smaller than 32 characters, but it's small enough."
    let mediumText = "This is a medium text. It's larger than the small text, but should be smaller than the large text. Let's just go ahead and write some more here. We may or may not reach a gas limit. I think we won't."
    let largeText = "This is a large text. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec euismod ut erat ac iaculis. Fusce non cursus lorem. Nulla a felis ut odio laoreet rhoncus quis non orci. Vestibulum posuere, arcu at tempus vehicula, nisi diam pellentesque sapien, quis molestie arcu neque sed dolor. Duis elementum mollis laoreet. In vitae sem volutpat, pulvinar quam id, gravida sapien. Fusce condimentum malesuada lacinia. Proin vitae nulla sit amet libero accumsan malesuada molestie ac magna. Fusce hendrerit sollicitudin elit, tristique gravida ex ultricies maximus. Nulla facilisi. Aenean enim odio, egestas non finibus id, dapibus quis ipsum. Integer interdum magna ut neque blandit gravida. Vestibulum semper elit et arcu pulvinar volutpat. Nam ipsum diam, gravida in posuere vitae, blandit vitae quam. Sed gravida a felis a dictum. Maecenas convallis, tellus id laoreet commodo, lorem nisl laoreet ligula, et interdum metus nunc faucibus massa. Etiam rutrum eget odio sit amet rutrum. Pellentesque blandit mi ac consequat elementum. Duis lorem orci, cursus sed metus ut, ullamcorper iaculis eros. Phasellus laoreet sit amet leo ac interdum. Proin dapibus euismod orci sed interdum. Sed condimentum pharetra tellus, a ornare nulla ullamcorper eu. Nam vitae augue sagittis, vehicula purus quis, fringilla nisi. Sed quis gravida ex. Interdum et malesuada fames ac ante ipsum primis in faucibus. Nulla facilisi. Aliquam quis ante lacinia, condimentum nibh vel, commodo orci. Maecenas eget eros et lorem malesuada accumsan. Sed blandit malesuada nisl eget finibus. Pellentesque turpis nisi, fermentum vel varius vitae, viverra id risus. Curabitur eget commodo justo."
    let giganticText = "This is a gigantic text. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc ac velit in justo aliquet elementum. Pellentesque lacinia, ligula quis feugiat convallis, magna ante tincidunt erat, quis porttitor nisi lacus porttitor est. Vestibulum venenatis vitae nunc non faucibus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Etiam dapibus sagittis rutrum. In ut lectus ex. Donec nec lorem eu erat ullamcorper sagittis vitae congue arcu. Curabitur nec fermentum velit. Quisque venenatis gravida erat, vitae luctus velit congue quis. Nam ultricies augue sit amet vulputate gravida. Fusce vitae dui nisi. Curabitur egestas vitae dui et fringilla. Interdum et malesuada fames ac ante ipsum primis in faucibus. Cras fermentum mi eu mi volutpat, id scelerisque risus egestas. Nunc vel massa purus. Sed id malesuada tortor. Curabitur pulvinar lectus metus, id convallis nibh mattis ac. Morbi finibus, quam eget elementum suscipit, eros odio mattis felis, ac aliquam ante orci pharetra ligula. Donec non turpis velit. Fusce congue sem magna, vitae fringilla nibh efficitur vitae. Cras sed tellus in justo vestibulum gravida at a ex. In fringilla dolor at arcu varius ultrices. Interdum et malesuada fames ac ante ipsum primis in faucibus. Integer ullamcorper libero rhoncus, tincidunt neque vitae, laoreet odio. Vivamus congue felis vel felis iaculis, id viverra quam scelerisque. Duis sed tellus id nibh semper sodales. Cras tempus, mauris ut faucibus lobortis, ex sapien accumsan ligula, quis luctus ipsum metus eu mauris. Nunc lacus est, efficitur eget nisi sed, gravida tristique nunc. Sed aliquet ligula ac euismod fermentum. Maecenas metus mi, mollis sit amet sem et, pellentesque luctus urna. Ut auctor velit ac magna lobortis, fringilla sodales nulla sodales. Morbi semper eget elit vitae blandit. Aenean at auctor odio. Ut lobortis aliquam enim quis efficitur. Aliquam erat volutpat. Vestibulum auctor nisl massa, et venenatis eros aliquet at. Sed pellentesque auctor leo, at interdum tellus. Vivamus varius gravida ullamcorper. Donec tempor enim non tellus bibendum, sed mollis dolor suscipit. Pellentesque venenatis accumsan velit, nec ornare eros varius vitae. Sed felis justo, vehicula vel eros et, feugiat maximus orci. Nulla nibh libero, gravida vel aliquam vitae, bibendum vel arcu. Suspendisse quis quam eu libero aliquet convallis. In in mollis magna, ut placerat metus. Nullam ut ipsum eget justo condimentum volutpat. Donec semper quis eros vel condimentum. Ut congue magna lorem, ac egestas turpis volutpat ut. In sapien nunc, semper vitae laoreet ac, imperdiet quis enim. Proin efficitur dapibus elit, at vulputate ante tempus sit amet. Nullam hendrerit justo eros, et ultricies lectus imperdiet at. Nulla facilisi. Pellentesque tempus, nulla quis pretium tristique, neque purus feugiat turpis, quis luctus felis velit ac tellus. Sed varius nibh id feugiat congue. Donec justo nisl, efficitur at dapibus vitae, pellentesque sed nisi. Curabitur id felis at nulla lobortis ultricies. Nullam ut enim nisi. Aliquam eu rhoncus elit. Vivamus lacinia orci vel est hendrerit, at vestibulum purus lobortis. Sed in tempor lacus. Aenean ut nisi consequat, pretium mauris vitae, elementum lorem. Curabitur vitae rutrum elit, nec malesuada enim. Nunc sagittis dolor sit amet orci tempus, eu laoreet lectus porttitor. Nullam nec ultricies mauris. Duis ultrices massa et elementum viverra. Suspendisse at magna facilisis lectus sollicitudin cursus. Etiam ut nisl ornare, dignissim nisi nec, elementum metus. Duis ante arcu, pharetra efficitur sagittis sit amet, laoreet at massa. Etiam felis libero, consectetur in mi vitae, sollicitudin lacinia mi. Maecenas ante ex, vehicula at vestibulum non, lacinia id lectus. Nulla a lacus tristique, malesuada tortor in, consequat erat. Curabitur accumsan arcu eu sem tristique malesuada. Nam aliquam lacus at pellentesque elementum. Duis ornare mi sit amet suscipit fringilla. Donec vel sapien orci. Donec pulvinar, tellus vitae accumsan pulvinar, ante nunc iaculis nisl, ac lacinia sapien erat et libero. Integer ultricies tortor id ligula tempus convallis. Aliquam luctus mattis feugiat. Sed sed metus ante. Ut fringilla nisl sit amet sapien tristique, vitae dictum tellus scelerisque. Phasellus consectetur molestie semper. Aenean eu justo faucibus, consectetur tellus a, commodo lacus. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Vestibulum scelerisque, risus eget varius posuere, justo lorem feugiat diam, non ultricies odio ipsum at augue. Etiam mollis tellus eros, non hendrerit lacus suscipit ut. Vivamus et nulla ex. Nullam mi tortor, volutpat nec sollicitudin ac, viverra cursus massa. Morbi ut libero non nunc dictum viverra. Vivamus id aliquam lorem. Nam nec nisi leo. Sed commodo aliquam dolor a congue. In id tincidunt dui. Etiam condimentum ullamcorper sem, et volutpat dui. Aenean suscipit eu diam eu egestas. Sed non justo semper, gravida elit vitae, viverra diam. Integer iaculis congue auctor. Aenean semper urna justo, ac consectetur arcu iaculis a. Suspendisse vel aliquam eros. In sit amet erat eu orci gravida pharetra sed non leo. Cras ut est eros. Duis at ante mi. Nunc pulvinar, ligula non elementum hendrerit, ligula felis mollis sapien, nec malesuada lorem magna in diam. Aenean eros justo, dapibus ut elit quis, congue tincidunt sem. Sed orci erat, sodales quis elit et, dictum cursus odio. Ut ut est quis ipsum maximus hendrerit. Nulla arcu elit, congue quis euismod ut, euismod ornare magna. Morbi vel tincidunt enim, volutpat fermentum nisl. Phasellus sit amet arcu facilisis, lacinia est ac, dictum felis. Nullam ut dolor ut sem venenatis blandit. Vestibulum id commodo risus. Nunc et consectetur velit. Ut diam sem, gravida feugiat dapibus ac, imperdiet in ex. Etiam blandit tortor ipsum, quis condimentum diam ultricies quis. Etiam iaculis ultricies facilisis. Morbi ligula leo, vulputate sit amet orci vel, blandit mollis neque. Duis et elit sed mi suscipit cursus."
    let gargantuanText = "This is a gargantuan text. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc ac velit in justo aliquet elementum. Pellentesque lacinia, ligula quisconvallis, magna ante tincidunt erat, quis porttitor nisi lacus porttitor est. Vestibulum venenatis vitae nunc non faucibus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Etiam dapibus sagittis rutrum. In ut lectus ex. Donec nec lorem eu erat ullamcorper sagittis vitae congue arcu. Curabitur nec fermentum velit. Quisque venenatis gravida erat, vitae luctus velit congue quis. Nam ultricies augue sit amet vulputate gravida. Fusce vitae dui nisi. Curabitur egestas vitae dui et fringilla. Interdum et malesuada fames ac ante ipsum primis in faucibus. Cras fermentum mi eu mi volutpat, id scelerisque risus egestas. Nunc vel massa purus. Sed id malesuada tortor. Curabitur pulvinar lectus metus, id convallis nibh mattis ac. Morbi finibus, quam eget elementum suscipit, eros odio mattis felis, ac aliquam ante orci pharetra ligula. Donec non turpis velit. Fusce congue sem magna, vitae fringilla nibh efficitur vitae. Cras sed tellus in justo vestibulum gravida at a ex. In fringilla dolor at arcu varius ultrices. Interdum et malesuada fames ac ante ipsum primis in faucibus. Integer ullamcorper libero rhoncus, tincidunt neque vitae, laoreet odio. Vivamus congue felis vel felis iaculis, id viverra quam scelerisque. Duis sed tellus id nibh semper sodales. Cras tempus, mauris ut faucibus lobortis, ex sapien accumsan ligula, quis luctus ipsum metus eu mauris. Nunc lacus est, efficitur eget nisi sed, gravida tristique nunc. Sed aliquet ligula ac euismod fermentum. Maecenas metus mi, mollis sit amet sem et, pellentesque luctus urna. Ut auctor velit ac magna lobortis, fringilla sodales nulla sodales. Morbi semper eget elit vitae blandit. Aenean at auctor odio. Ut lobortis aliquam enim quis efficitur. Aliquam erat volutpat. Vestibulum auctor nisl massa, et venenatis eros aliquet at. Sed pellentesque auctor leo, at interdum tellus. Vivamus varius gravida ullamcorper. Donec tempor enim non tellus bibendum, sed mollis dolor suscipit. Pellentesque venenatis accumsan velit, nec ornare eros varius vitae. Sed felis justo, vehicula vel eros et, feugiat maximus orci. Nulla nibh libero, gravida vel aliquam vitae, bibendum vel arcu. Suspendisse quis quam eu libero aliquet convallis. In in mollis magna, ut placerat metus. Nullam ut ipsum eget justo condimentum volutpat. Donec semper quis eros vel condimentum. Ut congue magna lorem, ac egestas turpis volutpat ut. In sapien nunc, semper vitae laoreet ac, imperdiet quis enim. Proin efficitur dapibus elit, at vulputate ante tempus sit amet. Nullam hendrerit justo eros, et ultricies lectus imperdiet at. Nulla facilisi. Pellentesque tempus, nulla quis pretium tristique, neque purus feugiat turpis, quis luctus felis velit ac tellus. Sed varius nibh id feugiat congue. Donec justo nisl, efficitur at dapibus vitae, pellentesque sed nisi. Curabitur id felis at nulla lobortis ultricies. Nullam ut enim nisi. Aliquam eu rhoncus elit. Vivamus lacinia orci vel est hendrerit, at vestibulum purus lobortis. Sed in tempor lacus. Aenean ut nisi consequat, pretium mauris vitae, elementum lorem. Curabitur vitae rutrum elit, nec malesuada enim. Nunc sagittis dolor sit amet orci tempus, eu laoreet lectus porttitor. Nullam nec ultricies mauris. Duis ultrices massa et elementum viverra. Suspendisse at magna facilisis lectus sollicitudin cursus. Etiam ut nisl ornare, dignissim nisi nec, elementum metus. Duis ante arcu, pharetra efficitur sagittis sit amet, laoreet at massa. Etiam felis libero, consectetur in mi vitae, sollicitudin lacinia mi. Maecenas ante ex, vehicula at vestibulum non, lacinia id lectus. Nulla a lacus tristique, malesuada tortor in, consequat erat. Curabitur accumsan arcu eu sem tristique malesuada. Nam aliquam lacus at pellentesque elementum. Duis ornare mi sit amet suscipit fringilla. Donec vel sapien orci. Donec pulvinar, tellus vitae accumsan pulvinar, ante nunc iaculis nisl, ac lacinia sapien erat et libero. Integer ultricies tortor id ligula tempus convallis. Aliquam luctus mattis feugiat. Sed sed metus ante. Ut fringilla nisl sit amet sapien tristique, vitae dictum tellus scelerisque. Phasellus consectetur molestie semper. Aenean eu justo faucibus, consectetur tellus a, commodo lacus. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Vestibulum scelerisque, risus eget varius posuere, justo lorem feugiat diam, non ultricies odio ipsum at augue. Etiam mollis tellus eros, non hendrerit lacus suscipit ut. Vivamus et nulla ex. Nullam mi tortor, volutpat nec sollicitudin ac, viverra cursus massa. Morbi ut libero non nunc dictum viverra. Vivamus id aliquam lorem. Nam nec nisi leo. Sed commodo aliquam dolor a congue. In id tincidunt dui. Etiam condimentum ullamcorper sem, et volutpat dui. Aenean suscipit eu diam eu egestas. Sed non justo semper, gravida elit vitae, viverra diam. Integer iaculis congue auctor. Aenean semper urna justo, ac consectetur arcu iaculis a. Suspendisse vel aliquam eros. In sit amet erat eu orci gravida pharetra sed non leo. Cras ut est eros. Duis at ante mi. Nunc pulvinar, ligula non elementum hendrerit, ligula felis mollis sapien, nec malesuada lorem magna in diam. Aenean eros justo, dapibus ut elit quis, congue tincidunt sem. Sed orci erat, sodales quis elit et, dictum cursus odio. Ut ut est quis ipsum maximus hendrerit. Nulla arcu elit, congue quis euismod ut, euismod ornare magna. Morbi vel tincidunt enim, volutpat fermentum nisl. Phasellus sit amet arcu facilisis, lacinia est ac, dictum felis. Nullam ut dolor ut sem venenatis blandit. Vestibulum id commodo risus. Nunc et consectetur velit. Ut diam sem, gravida feugiat dapibus ac, imperdiet in ex. Etiam blandit tortor ipsum, quis condimentum diam ultricies quis. Etiam iaculis ultricies facilisis. Morbi ligula leo, vulputate sit amet orci vel, blandit mollis neque. Duis et elit sed mi suscipit cursus. This is a gigantic text. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc ac velit in justo aliquet elementum. Pellentesque lacinia, ligula quis feugiat convallis, magna ante tincidunt erat, quis porttitor nisi lacus porttitor est. Vestibulum venenatis vitae nunc non faucibus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Etiam dapibus sagittis rutrum. In ut lectus ex. Donec nec lorem eu erat ullamcorper sagittis vitae congue arcu. Curabitur nec fermentum velit. Quisque venenatis gravida erat, vitae luctus velit congue quis. Nam ultricies augue sit amet vulputate gravida. Fusce vitae dui nisi. Curabitur egestas vitae dui et fringilla. Interdum et malesuada fames ac ante ipsum primis in faucibus. Cras fermentum mi eu mi volutpat, id scelerisque risus egestas. Nunc vel massa purus. Sed id malesuada tortor. Curabitur pulvinar lectus metus, id convallis nibh mattis ac. Morbi finibus, quam eget elementum suscipit, eros odio mattis felis, ac aliquam ante orci pharetra ligula. Donec non turpis velit. Fusce congue sem magna, vitae fringilla nibh efficitur vitae. Cras sed tellus in justo vestibulum gravida at a ex. In fringilla dolor at arcu varius ultrices. Interdum et malesuada fames ac ante ipsum primis in faucibus. Integer ullamcorper libero rhoncus, tincidunt neque vitae, laoreet odio. Vivamus congue felis vel felis iaculis, id viverra quam scelerisque. Duis sed tellus id nibh semper sodales. Cras tempus, mauris ut faucibus lobortis, ex sapien accumsan ligula, quis luctus ipsum metus eu mauris. Nunc lacus est, efficitur eget nisi sed, gravida tristique nunc. Sed aliquet ligula ac euismod fermentum. Maecenas metus mi, mollis sit amet sem et, pellentesque luctus urna. Ut auctor velit ac magna lobortis, fringilla sodales nulla sodales. Morbi semper eget elit vitae blandit. Aenean at auctor odio. Ut lobortis aliquam enim quis efficitur. Aliquam erat volutpat. Vestibulum auctor nisl massa, et venenatis eros aliquet at. Sed pellentesque auctor leo, at interdum tellus. Vivamus varius gravida ullamcorper. Donec tempor enim non tellus bibendum, sed mollis dolor suscipit. Pellentesque venenatis accumsan velit, nec ornare eros varius vitae. Sed felis justo, vehicula vel eros et, feugiat maximus orci. Nulla nibh libero, gravida vel aliquam vitae, bibendum vel arcu. Suspendisse quis quam eu libero aliquet convallis. In in mollis magna, ut placerat metus. Nullam ut ipsum eget justo condimentum volutpat. Donec semper quis eros vel condimentum. Ut congue magna lorem, ac egestas turpis volutpat ut. In sapien nunc, semper vitae laoreet ac, imperdiet quis enim. Proin efficitur dapibus elit, at vulputate ante tempus sit amet. Nullam hendrerit justo eros, et ultricies lectus imperdiet at. Nulla facilisi. Pellentesque tempus, nulla quis pretium tristique, neque purus feugiat turpis, quis luctus felis velit ac tellus. Sed varius nibh id feugiat congue. Donec justo nisl, efficitur at dapibus vitae, pellentesque sed nisi. Curabitur id felis at nulla lobortis ultricies. Nullam ut enim nisi. Aliquam eu rhoncus elit. Vivamus lacinia orci vel est hendrerit, at vestibulum purus lobortis. Sed in tempor lacus. Aenean ut nisi consequat, pretium mauris vitae, elementum lorem. Curabitur vitae rutrum elit, nec malesuada enim. Nunc sagittis dolor sit amet orci tempus, eu laoreet lectus porttitor. Nullam nec ultricies mauris. Duis ultrices massa et elementum viverra. Suspendisse at magna facilisis lectus sollicitudin cursus. Etiam ut nisl ornare, dignissim nisi nec, elementum metus. Duis ante arcu, pharetra efficitur sagittis sit amet, laoreet at massa. Etiam felis libero, consectetur in mi vitae, sollicitudin lacinia mi. Maecenas ante ex, vehicula at vestibulum non, lacinia id lectus. Nulla a lacus tristique, malesuada tortor in, consequat erat. Etiam iaculis ultricies. Morbi ligula leo, vulputate sit amet orci vel, blandit mollis neque. Duis et elit sed mi suscipit cursus."
    //gargantuan has 10k characters. This should be the limit, handled by the frontend. It'll consume ~6.5 million Gas.


    describe('create bin', () => {
        beforeEach('Deploy contract', async () => {
            everbin = await everbinArtifacts.new({from:owner})
        })

        it('creates a new bin with small text', async () => {
            await everbin.create(smallText, { from:user1 })
        })

        it('creates a new bin with medium text', async () => {
            await everbin.create(mediumText, { from:user1 })
        })

        it('creates a new bin with large text', async () => {
            await everbin.create(largeText, { from:user1 })
        })

        it('creates a new bin with gigantic text', async () => {
            await everbin.create(giganticText, { from:user1 })
        })

        it('creates a new bin with gargantuan text', async () => {
            await everbin.create(gargantuanText, { from:user1 })
        })

        //@SOL: event BinCreated(address from, uint id);
        it('emits event', async () => {
            let result = await everbin.create(smallText, { from:user1 })

            await truffleAssert.eventEmitted(result, 'BinCreated', (ev) => {
                return ev.from == user1 && ev.id == "1"
            })
        })

        it('Estimate gas', async () => {
            await txUtils.printGasUsed(everbin.create(smallText, { from:user1 }), "Small Text")
            await txUtils.printGasUsed(everbin.create(mediumText, { from:user1 }), "Medium Text")
            await txUtils.printGasUsed(everbin.create(largeText, { from:user1 }), "Large Text")
            await txUtils.printGasUsed(everbin.create(giganticText, { from:user1 }), "Gigantic Text")
            await txUtils.printGasUsed(everbin.create(gargantuanText, { from:user1 }), "Gargantuan Text")
        })
    })
})